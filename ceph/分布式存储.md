#分布式存储#
-------------------------------
分布式存储系统定义：
> 分布式存储系统是大量普通PC服务通过Internet互联，对外作为一个整体提供存储服务。

具有以下的主要特性：
>* 可扩展性
>* 低成本
>* 高性能
>* 易用

挑战主要在于数据、状态信息的持久化，要求咋自动迁移、自动容错、并发读写的过程中保证数据的一致性。主要涉及的的技术主要来自两个领域：分布式系统以及存储。

##分布式系统##

>* 数据分布
>* 一致性
>* 容错
>* 负载均衡
>* 事务与并发控制
>* 易用性

**衡量指标**
>* 性能：吞吐能力以及系统响应时间
>* 可用性：系统在面对各种异常时可以提供正常服务的能力
>* 一致性
>* 可扩展性

**数据分布**
> 哈希分布，如一致性哈希
> 顺序分布
> Ceph中Crush算法

*哈希分布*

根据数据的特征值计算哈希值，映射到对应的服务器上。但是，当服务器上线或下线时，数据映射被打乱，几乎所有数据都要重新分布，将带来大量的数据迁移。

*一致性哈希*

算法思想：给系统中每个节点分配一个随机token，这些token构成一个哈希环。执行数据存放操作时，先计算Key的哈希值。然后存放到顺时针方向第一个大于或者等于该哈希值得token所在的节点。一致性哈希的优点在于节点的加入和删除只会影响到哈希环中相邻的节点，而对其他节点没影响。

*顺序分布*

将存储的大表划分多个小表，在将小表以一定的策略分配到存储节点上。

*基于PG的Crush算法*
>  ?
>  
>  ?  
>  
>  ?

**可靠性和一致性**

为了保证分布式存储系统的高可靠和高可用，数据在系统中一班存储多个副本。
一致性和可用性是矛盾的，强同步复制协议可以保证主副本之间的一致性，但是当备副本出现故障时，可能阻塞系统正常的写服务。异步复制协议可以保证可用性，但是不能保证一致性。当主副本出现故障时，有数据丢失的可能。

##存储##
传统架构：
> DAS：Directed Attached Storage，服务器直接接磁盘。服务器之间不能共享存储空间;  
> SAN：利用Fabric Network连接服务器和存储设备。  
> NFS：文件存储协议

面向应用：
>对象存储；  
>块存储；  
>文件存储。

